"use strict";var Se=Object.create;var G=Object.defineProperty;var qe=Object.getOwnPropertyDescriptor;var Pe=Object.getOwnPropertyNames;var Te=Object.getPrototypeOf,Re=Object.prototype.hasOwnProperty;var we=(e,s,r,a)=>{if(s&&typeof s=="object"||typeof s=="function")for(let o of Pe(s))!Re.call(e,o)&&o!==r&&G(e,o,{get:()=>s[o],enumerable:!(a=qe(s,o))||a.enumerable});return e};var m=(e,s,r)=>(r=e!=null?Se(Te(e)):{},we(s||!e||!e.__esModule?G(r,"default",{value:e,enumerable:!0}):r,e));var B=m(require("express")),xe=m(require("helmet")),Ee=m(require("config")),F=m(require("swagger-ui-express"));var ne=m(require("express"));var d="There was an error at the backend service. Please contact an administrator";var N=m(require("jsonwebtoken")),$=require("bcryptjs");var z=require("redis"),Le=(0,z.createClient)({url:`redis://${process.env.REDIS_HOST}:${process.env.REDIS_PORT}`}),b=Le;var h={REALESTATE_READ:"read.real-estate-post",REALESTATE_WRITE:"write.real-estate-post"},Q={"GET /v1/real-estate-listing/":h.REALESTATE_READ,"POST /v1/real-estate-listing/":h.REALESTATE_WRITE,"PATCH /v1/real-estate-listing/":h.REALESTATE_WRITE,"DELETE /v1/real-estate-listing/":h.REALESTATE_WRITE};var _e=[{clientId:"E4Uzsjr1DNYIT3k50bxB5jEfO56WzgWh",hashClientSecret:"$2y$10$3/2a70eshJFIptFC/fTjeO2k1/YjZx8NC4U3izn1mTkVgLYtnOG8a",scopes:[h.REALESTATE_READ,h.REALESTATE_WRITE]},{clientId:"sD5lnJ8Uz6dfdqFhxyVJc1pFnxBjGIDq",hashClientSecret:"$2y$10$lgcPzuriZi4EBj1DWf2oqOrHcF1pv3o9umVHp.7azxiUbkcygViJK",scopes:[h.REALESTATE_READ]}],De=async e=>{let s=_e.find(o=>o.clientId===e.clientId);return s?(0,$.compare)(e.clientSecret,s.hashClientSecret)?{accessToken:N.default.sign({clientId:s.clientId,scopes:s.scopes},process.env.JWT_ACCESS_TOKEN_SECRET,{expiresIn:process.env.JWT_DEFAULT_EXPIRES_IN_MILISECONDS,subject:s.clientId,jwtid:`${Math.floor(Date.now())}`}),scopes:s.scopes,expiresIn:process.env.JWT_DEFAULT_EXPIRES_IN_MILISECONDS}:(console.warn("Attempted login with invalid clientSecret"),null):(console.warn("Attempted login with invalid clientId"),null)},Ne=async e=>{let s=N.default.verify(e,process.env.JWT_ACCESS_TOKEN_SECRET),r=Math.floor(Date.now()/1e3),a=s.exp-r;return await b.setEx(e,a,"true"),!0},O={login:De,logout:Ne};var H=async(e,s,r)=>{try{let{body:a}=e,o=await O.login(a);o?s.status(200).json(o):s.status(403).json({message:"Invalid credentials"})}catch(a){console.error('There was an error at "login" controller!',a),s.status(500).json({message:d})}},W=async(e,s,r)=>{try{let a=e.headers.authorization;await O.logout(a?.split(" ")?.pop())?s.status(200).json({message:"Token invalidated successfully"}):s.status(422).json({message:"Could not invalidate token"})}catch(a){console.error('There was an error at "logout" controller!',a),s.status(500).json({message:d})}};var ee=m(require("joi")),te=m(require("@joi/date")),se=require("express-joi-validation");var w=999999999999e-2,J=100,V="created_at",Z="desc",X=10,Y=0,K=["title","address","squareMeters","bedrooms","bathrooms","lifeQualityIndex","hasPorch","price","createdAt","updatedAt"];var u=(a=>(a.NONE="none",a.OWN="own",a.COMMUNITY="community",a))(u||{}),A=(a=>(a.NONE="none",a.DRIVEWAY="driveway",a.GARAGE="garage",a))(A||{}),y=(a=>(a.ON_SALE="ON_SALE",a.ON_HOLD="ON_HOLD",a.SOLD="SOLD",a))(y||{}),f=(a=>(a.US_DOLLAR="USD",a.EURO="EUR",a.ARGENTINIAN_PESO="ARS",a))(f||{});var t=ee.default.extend(te.default).extend(e=>({base:e.array(),type:"stringArray",coerce:(s,r)=>({value:s.split?s.split(","):s})})),L=(0,se.createValidator)({passError:!0}),ae=L.body(t.object({clientId:t.string().min(1).max(255).required(),clientSecret:t.string().min(1).max(255).required()})),re=L.query(t.object({titleLike:t.string().min(1).max(255).optional(),addressLike:t.string().min(1).max(255).optional(),minSquareMeters:t.number().integer().min(1).max(32767).default(null).when("maxSquareMeters",{not:null,then:t.number().integer().min(1).less(t.ref("maxSquareMeters")).default(1)}),maxSquareMeters:t.number().integer().min(1).max(32767).default(null),bedrooms:t.number().integer().min(1).max(32767).optional(),minBedrooms:t.number().integer().min(1).max(32767).optional(),bathrooms:t.number().integer().min(1).max(32767).optional(),minBathrooms:t.number().integer().min(1).max(32767).optional(),minLifeQualityIndex:t.number().precision(2).min(0).max(10).default(null).when("maxLifeQualityIndex",{not:null,then:t.number().precision(2).min(0).less(t.ref("maxLifeQualityIndex")).default(0)}),maxLifeQualityIndex:t.number().precision(2).min(0).max(10).default(null),hasPorch:t.boolean().optional(),poolType:t.stringArray().items(t.string().valid(...Object.values(u))).single().unique().optional(),barbequeArea:t.stringArray().items(t.string().valid(...Object.values(u))).single().unique().optional(),parkingSpace:t.stringArray().items(t.string().valid(...Object.values(A))).single().unique().optional(),minCreatedAt:t.date().iso().default(null).when("maxCreatedAt",{not:null,then:t.date().iso().less(t.ref("maxCreatedAt")).default("2000-01-01T00:00:00.000Z")}),maxCreatedAt:t.date().iso().default(null),minUpdatedAt:t.date().iso().default(null).when("maxUpdatedAt",{not:null,then:t.date().iso().less(t.ref("maxUpdatedAt")).default("2000-01-01T00:00:00.000Z")}),maxUpdatedAt:t.date().raw().default(null),status:t.stringArray().items(t.string().valid(...Object.values(y))).single().unique().optional(),currency:t.stringArray().items(t.string().valid(...Object.values(f))).single().unique().optional(),minPrice:t.number().precision(2).min(0).max(w).default(null).when("maxPrice",{not:null,then:t.number().precision(2).less(t.ref("maxPrice")).default(0)}),maxPrice:t.number().precision(2).min(0).max(w).default(null),limit:t.number().integer().min(1).max(J).optional(),offset:t.number().integer().min(0).optional(),order_by:t.string().valid(...K).optional(),order_direction:t.string().valid("asc","desc").optional()})),_=L.params(t.object({id:t.number().integer().min(1).max(2147483647).required()})),oe=L.body(t.object({title:t.string().min(1).max(255).required(),address:t.string().min(1).max(255).required(),squareMeters:t.number().integer().min(1).max(32767).required(),bedrooms:t.number().integer().min(1).max(32767).required(),bathrooms:t.number().integer().min(1).max(32767).required(),lifeQualityIndex:t.number().precision(2).min(0).max(10).optional(),hasPorch:t.boolean().required(),poolType:t.string().valid(...Object.values(u)).required(),barbequeArea:t.string().valid(...Object.values(u)).required(),parkingSpace:t.string().valid(...Object.values(A)).required(),status:t.string().valid(...Object.values(y)).required(),currency:t.string().valid(...Object.values(f)).required(),price:t.number().precision(2).min(0).max(w).required()})),ie=L.body(t.object({title:t.string().min(1).max(255).optional(),address:t.string().min(1).max(255).optional(),squareMeters:t.number().integer().min(1).max(32767).optional(),bedrooms:t.number().integer().min(1).max(32767).optional(),bathrooms:t.number().integer().min(1).max(32767).optional(),lifeQualityIndex:t.number().precision(2).min(0).max(10).optional(),hasPorch:t.boolean().optional(),poolType:t.string().valid(...Object.values(u)).optional(),barbequeArea:t.string().valid(...Object.values(u)).optional(),parkingSpace:t.string().valid(...Object.values(A)).optional(),status:t.string().valid(...Object.values(y)).optional(),currency:t.string().valid(...Object.values(f)).optional(),price:t.number().precision(2).min(0).max(w).optional()}));var j=ne.default.Router();j.post("/login",ae,H);j.post("/logout",W);var pe=j;var ye=m(require("express"));var n=require("sequelize");var U=require("sequelize");U.Sequelize.DataTypes.postgres.DECIMAL.parse=parseFloat;var je=new U.Sequelize(process.env.DB_NAME,process.env.DB_USER,process.env.DB_PASSWORD,{host:process.env.DB_HOST,port:process.env.DB_PORT,dialect:process.env.DB_DIALECT,pool:{max:5,min:0,acquire:3e4,idle:1e4}}),p=je;var i=require("sequelize");var D=class extends i.Model{id;title;address;squareMeters;bedrooms;bathrooms;lifeQualityIndex;hasPorch;poolType;barbequeArea;parkingSpace;isActive;status;price;currency;createdAt;updatedAt};D.init({id:{field:"id",type:i.DataTypes.INTEGER,autoIncrement:!0,primaryKey:!0},title:{field:"title",type:i.DataTypes.STRING(255),unique:!0,allowNull:!1},address:{field:"address",type:i.DataTypes.STRING(255),unique:!0,allowNull:!1},squareMeters:{field:"square_meters",type:i.DataTypes.SMALLINT,allowNull:!1},bedrooms:{field:"bedrooms",type:i.DataTypes.SMALLINT,allowNull:!1},bathrooms:{field:"bathrooms",type:i.DataTypes.SMALLINT,allowNull:!1},lifeQualityIndex:{field:"life_quality_index",type:i.DataTypes.DECIMAL(10,2),allowNull:!0,comment:"Based on https://icv.conicet.gov.ar/ data"},hasPorch:{field:"has_porch",type:i.DataTypes.BOOLEAN,allowNull:!1},poolType:{field:"pool_type",type:i.DataTypes.ENUM(...Object.values(u)),allowNull:!1},barbequeArea:{field:"barbeque_area",type:i.DataTypes.ENUM(...Object.values(u)),allowNull:!1},parkingSpace:{field:"parking_space",type:i.DataTypes.ENUM(...Object.values(A)),allowNull:!1},isActive:{field:"active",type:i.DataTypes.BOOLEAN,allowNull:!1},status:{field:"status",type:i.DataTypes.ENUM(...Object.values(y)),allowNull:!1},price:{field:"price",type:i.DataTypes.DECIMAL(10,2),allowNull:!1},currency:{field:"currency",type:i.DataTypes.ENUM(...Object.values(f)),allowNull:!1}},{sequelize:p,tableName:"post",createdAt:"created_at",updatedAt:"updated_at"});p.query("SELECT SETVAL('post_id_seq', (SELECT MAX(id) from post), true);");var l=D;var v=require("sequelize");var I=class extends v.Model{id;status;postId;createdAt};I.init({id:{field:"id",type:v.DataTypes.INTEGER,autoIncrement:!0,primaryKey:!0},status:{field:"status",type:v.DataTypes.ENUM(...Object.values(y)),allowNull:!1},postId:{field:"post_id",type:v.DataTypes.INTEGER,allowNull:!1,references:{model:l,key:"id"}}},{sequelize:p,tableName:"post_status_history",createdAt:"created_at",updatedAt:!1});l.hasMany(I,{foreignKey:"post_id",onDelete:"CASCADE"});I.belongsTo(l,{foreignKey:"post_id",allowNull:!1});p.query("SELECT SETVAL('post_status_history_id_seq', (SELECT MAX(id) from post_status_history), true);");var k=I;var x=require("sequelize");var S=class extends x.Model{id;price;currency;postId;createdAt};S.init({id:{field:"id",type:x.DataTypes.INTEGER,autoIncrement:!0,primaryKey:!0},price:{field:"price",type:x.DataTypes.DECIMAL(10,2),allowNull:!1},currency:{field:"currency",type:x.DataTypes.ENUM(...Object.values(f)),allowNull:!1},postId:{field:"post_id",type:x.DataTypes.INTEGER,allowNull:!1,references:{model:l,key:"id"}}},{sequelize:p,tableName:"price_listing_history",createdAt:"created_at",updatedAt:!1});l.hasMany(S,{foreignKey:"post_id",onDelete:"CASCADE"});S.belongsTo(l,{foreignKey:"post_id",allowNull:!1});p.query("SELECT SETVAL('price_listing_history_id_seq', (SELECT MAX(id) from price_listing_history), true);");var C=S;var Ue=async(e,s=V,r=Z,a=X,o=Y)=>await l.findAndCountAll({attributes:{exclude:["isActive"]},where:{isActive:!0,...e?.titleLike&&{title:{[n.Op.like]:`%${e.titleLike}%`}},...e?.addressLike&&{address:{[n.Op.like]:`%${e.addressLike}%`}},...e?.minSquareMeters&&{squareMeters:{[n.Op.gte]:e.minSquareMeters}},...e?.maxSquareMeters&&{squareMeters:{[n.Op.lte]:e.maxSquareMeters}},...e?.bedrooms&&{bedrooms:e.bedrooms},...e?.minBedrooms&&{bedrooms:{[n.Op.gte]:e.minBedrooms}},...e?.bathrooms&&{bedrooms:e.bathrooms},...e?.minBathrooms&&{bedrooms:{[n.Op.gte]:e.minBathrooms}},...e?.minLifeQualityIndex&&{lifeQualityIndex:{[n.Op.gte]:e.minLifeQualityIndex}},...e?.maxLifeQualityIndex&&{lifeQualityIndex:{[n.Op.lte]:e.maxLifeQualityIndex}},...typeof e?.hasPorch=="boolean"&&{hasPorch:e.hasPorch},...e?.poolType&&{poolType:e.poolType},...e?.barbequeArea&&{barbequeArea:e.barbequeArea},...e?.parkingSpace&&{parkingSpace:e.parkingSpace},...e?.minCreatedAt&&{createdAt:{[n.Op.gte]:e.minCreatedAt}},...e?.maxCreatedAt&&{createdAt:{[n.Op.lte]:e.maxCreatedAt}},...e?.minUpdatedAt&&{updatedAt:{[n.Op.gte]:e.minUpdatedAt}},...e?.maxUpdatedAt&&{updatedAt:{[n.Op.lte]:e.maxUpdatedAt}},...e?.status&&{status:e.status},...e?.currency&&{currency:e.currency},...e?.minPrice&&{price:{[n.Op.gte]:e.minPrice}},...e?.maxPrice&&{price:{[n.Op.lte]:e.maxPrice}}},order:[[s,r]],limit:a,offset:o}),ke=async e=>await l.findByPk(e,{raw:!0}),Ce=async e=>await p.transaction(async s=>{let r=await l.create(e,{transaction:s,fields:["title","address","squareMeters","bedrooms","bathrooms","lifeQualityIndex","hasPorch","poolType","barbequeArea","parkingSpace","status","price","currency"]});return await k.create({status:e.status,postId:r.dataValues.id},{transaction:s,fields:["status","postId"]}),await C.create({currency:e.currency,price:e.price,postId:r.dataValues.id},{transaction:s,fields:["currency","price","postId"]}),r}),Me=async(e,s)=>await p.transaction(async r=>(await l.update(s,{transaction:r,where:{id:e},fields:["title","address","squareMeters","bedrooms","bathrooms","lifeQualityIndex","hasPorch","poolType","barbequeArea","parkingSpace","status","price","currency"]}))[0]?(s.status&&await k.create({status:s.status,postId:e},{transaction:r,fields:["status","postId"]}),s.price&&s.currency&&await C.create({currency:s.currency,price:s.price,postId:e},{transaction:r,fields:["currency","price","postId"]}),!0):!1),Be=async e=>(await l.update({isActive:!1},{where:{id:e,isActive:!0}}))[0],q={getAllActiveWithStatusAndPrice:Ue,getByKey:ke,insertWithStatusHistoryAndPriceHistory:Ce,updateWithStatusHistoryAndPriceHistory:Me,softDelete:Be};var Fe=async e=>{let{limit:s,offset:r,orderBy:a,orderDirection:o,...R}=e,E=await q.getAllActiveWithStatusAndPrice(R,a,o,s,r);return{results:E.rows,total:E.count}},Ge=async e=>await q.getByKey(e),ze=async e=>await q.insertWithStatusHistoryAndPriceHistory(e),Qe=async(e,s)=>await q.updateWithStatusHistoryAndPriceHistory(e,s),$e=async e=>await q.softDelete(e),P={search:Fe,get:Ge,create:ze,update:Qe,softDelete:$e};var le=async(e,s,r)=>{try{let{query:a}=e,o=await P.search(a);s.status(200).json(o)}catch(a){console.error('There was an error at "searchPosts" controller!',a),s.status(500).json({message:d})}},ce=async(e,s,r)=>{try{let{params:a}=e,o=await P.get(a.id);o?.isActive===!0?s.status(200).json(o):(o?.isActive===!1&&console.warn('Attempted to retrieve a deleted post from "getPost" controller'),s.status(204))}catch(a){console.error('There was an error at "getPost" controller!',a),s.status(500).json({message:d})}},ue=async(e,s,r)=>{try{let{body:a}=e,o=await P.create(a);o?s.status(201).json(o):s.status(422).json({message:"Could not create post"})}catch(a){console.error('There was an error at "createNewPost" controller!',a),s.status(500).json({message:d})}},me=async(e,s,r)=>{try{let{params:a,body:o}=e;await P.update(a.id,o)?s.status(200).json({message:"Post updated successfully"}):s.status(422).json({message:"Could not update post"})}catch(a){console.error('There was an error at "updatePost" controller!',a),s.status(500).json({message:d})}},de=async(e,s,r)=>{try{let{params:a}=e;await P.softDelete(a.id)?s.status(200).json({message:"Post deleted successfully"}):s.status(422).json({message:"Could not delete post"})}catch(a){console.error('There was an error at "softDeletePost" controller!',a),s.status(500).json({message:d})}};var T=ye.default.Router();T.get("/:id",_,ce);T.patch("/:id",[_,ie],me);T.delete("/:id",_,de);T.get("/",re,le);T.post("/",oe,ue);var fe=T;var he=(e,s,r,a)=>{e&&e.error&&e.error.isJoi?r.status(400).json({message:"Invalid request",validationErrors:e.error.details.map(({message:o,context:R,path:E})=>({path:E,error:o.replace(`"${R.label}" `,"")}))}):a(e)};var ge=m(require("jsonwebtoken"));var be=async(e,s,r)=>{let a=e.headers.authorization?.split(" ")?.pop();if(!a)return s.status(401).json({message:"Unauthorized"});try{let o=ge.default.verify(a,process.env.JWT_ACCESS_TOKEN_SECRET);if(await b.exists(a)===1)return console.warn("Attempted access with an expired access token"),s.status(401).json({message:"Unauthorized"});let E=`${e.method} ${e.baseUrl}${e.path}`;for(let[ve,Ie]of Object.entries(Q))if(E.includes(ve)&&o.scopes.includes(Ie))return r();return console.warn("Attempted access to an unauthorized URL"),s.status(401).json({message:"Unauthorized"})}catch{return console.warn("Could not verify token (possibly expired or invalid?)"),s.status(401).json({message:"Unauthorized"})}r()};var Ae={openapi:"3.0.0",info:{version:"1.0.0",title:"Real Estate CRUD API",description:"Basic backend API REST CRUD themed on real estate listings",termsOfService:"http://swagger.io/terms/",contact:{name:"Sergio N. Raggio",email:"sergio.nr92@gmail.com",url:"https://www.linkedin.com/in/sergionicolasraggio"},license:{name:"GNU GPLv3",url:"https://choosealicense.com/licenses/gpl-3.0/"}},servers:[{url:"http://localhost:8080/"}],paths:{"v1/auth/login":{post:{summary:"Generates an access token",description:"Generates an access token based on a client ID and a client secret",operationId:"login",requestBody:{description:"ID and secret key pair",required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/Login"},examples:{"Login as Admin":{value:{clientId:"E4Uzsjr1DNYIT3k50bxB5jEfO56WzgWh",clientSecret:"Yu2xFzldqavqCxOcfrzg4oud2LmrnL9FO9HOhlAWDBh1lV9kjUvtnquogX9EhcY1"}},"Login as read-only user":{value:{clientId:"sD5lnJ8Uz6dfdqFhxyVJc1pFnxBjGIDq",clientSecret:"kFvZkcTui6icniNuRv1rNBFzUQ5VcmI1Jgy4Cz25bG9DC3xBNhSGakXWdMNlWNEG"}}}}}},responses:{"200":{summary:"Successful response",description:"Login successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/LoginResponseSuccess"},examples:{"Login as Admin":{value:{accessToken:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjbGllbnRJZCI6IkU0VXpzanIxRE5ZSVQzazUwYnhCNWpFZk81Nld6Z1doIiwic2NvcGVzIjpbInJlYWQucmVhbC1lc3RhdGUtcG9zdCIsIndyaXRlLnJlYWwtZXN0YXRlLXBvc3QiXSwiaWF0IjoxNzIwOTc0MTM2LCJleHAiOjE3MjA5NzUwMzYsInN1YiI6IkU0VXpzanIxRE5ZSVQzazUwYnhCNWpFZk81Nld6Z1doIiwianRpIjoiMTcyMDk3NDEzNjU4MCJ9.dkMHdi2bBDbudPp5VWz00E7W3i-7TkbIm3l4cJSncks",scopes:["read.real-estate-post","write.real-estate-post"],expiresIn:"900000"}},"Login as read-only user":{value:{accessToken:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjbGllbnRJZCI6IkU0VXpzanIxRE5ZSVQzazUwYnhCNWpFZk81Nld6Z1doIiwic2NvcGVzIjpbInJlYWQucmVhbC1lc3RhdGUtcG9zdCIsIndyaXRlLnJlYWwtZXN0YXRlLXBvc3QiXSwiaWF0IjoxNzIwOTc0MTM2LCJleHAiOjE3MjA5NzUwMzYsInN1YiI6IkU0VXpzanIxRE5ZSVQzazUwYnhCNWpFZk81Nld6Z1doIiwianRpIjoiMTcyMDk3NDEzNjU4MCJ9.dkMHdi2bBDbudPp5VWz00E7W3i-7TkbIm3l4cJSncks",scopes:["read.real-estate-post"],expiresIn:"900000"}}}}}},"400":{summary:"Invalid input object",description:"Invalid input object response",content:{"application/json":{schema:{$ref:"#/components/schemas/GenericResponse"},example:{value:{message:"Invalid request"}}}}},"403":{summary:"Invalid credentials response",description:"Login invalid credentials response",content:{"application/json":{schema:{$ref:"#/components/schemas/GenericResponse"},example:{value:{message:"Invalid credentials"}}}}},default:{summary:"Unexpected error",description:"Unexpected error",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"},example:{value:{message:"Internal server error"}}}}}}}},"v1/auth/logout":{post:{summary:"Blacklists an access token",description:"Blacklists an access token",operationId:"logout",security:[{BearerAuth:[]}],responses:{"200":{summary:"Successful response",description:"Logout successful response",content:{"application/json":{schema:{$ref:"#/components/schemas/GenericResponse"},example:{value:{message:"Token invalidated successfully"}}}}},"401":{summary:"Unauthorized response",description:"Unauthorized response",content:{"application/json":{schema:{$ref:"#/components/schemas/GenericResponse"},example:{value:{message:"Unauthorized"}}}}},"422":{summary:"Logout failed response",description:"Logout failed response (could not invalidate bearer token)",content:{"application/json":{schema:{$ref:"#/components/schemas/GenericResponse"},example:{value:{message:"Could not invalidate bearer token"}}}}},default:{summary:"Unexpected error",description:"Unexpected error",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"},example:{value:{message:"Internal server error"}}}}}}}},"v1/real-estate-listing":{get:{summary:"Gets a list of multiple real estate postings",description:"Gets a list of multiple active real estate postings with their details (filter, pagination and ordering based on search query params)",operationId:"searchPosts",security:[{BearerAuth:[]}],parameters:[{name:"titleLike",in:"query",description:"Filter to find real estate post listings containing said value",required:!1,schema:{type:"string",minLength:1,maxLength:255},example:"house"},{name:"addressLike",in:"query",description:"Filter to find real estate post listings whose address contains said value",required:!1,schema:{type:"string",minLength:1,maxLength:255},example:"Plomer"},{name:"minSquareMeters",in:"query",description:"Filter to find real estate post listings containing equal or greater square meters than said specified value",required:!1,schema:{type:"integer",format:"int32",minimum:1,maximum:32767},example:100},{name:"maxSquareMeters",in:"query",description:"Filter to find real estate post listings containing equal or lesser square meters than said specified value",required:!1,schema:{type:"integer",format:"int32",minimum:1,maximum:32767},example:300},{name:"bedrooms",in:"query",description:"Filter to find real estate post listings containing exactly said number of bedrooms based on the value",required:!1,schema:{type:"integer",format:"int32",minimum:1,maximum:32767},example:2},{name:"minBedrooms",in:"query",description:"Filter to find real estate post listings containing at least said number of bedrooms based on the value",required:!1,schema:{type:"integer",format:"int32",minimum:1,maximum:32767},example:2},{name:"bathrooms",in:"query",description:"Filter to find real estate post listings containing exactly said number of bathrooms based on the value",required:!1,schema:{type:"integer",format:"int32",minimum:1,maximum:32767},example:1},{name:"minBathrooms",in:"query",description:"Filter to find real estate post listings containing at least said number of bathrooms based on the value",required:!1,schema:{type:"integer",format:"int32",minimum:1,maximum:32767},example:1},{name:"minLifeQualityIndex",in:"query",description:"Filter to find real estate post listings located in an area of at least said value of life quality index (based on https://icv.conicet.gov.ar/)",required:!1,schema:{type:"number",format:"float",minimum:0,maximum:10},example:6.5},{name:"maxLifeQualityIndex",in:"query",description:"Filter to find real estate post listings located in an area of said maximum value of life quality index (based on https://icv.conicet.gov.ar/)",required:!1,schema:{type:"number",format:"float",minimum:0,maximum:10},example:8},{name:"hasPorch",in:"query",description:"Filter to find real estate post listings containing (or not) a porch",required:!1,schema:{type:"boolean"},example:!1},{name:"poolType",in:"query",description:"Filter to find real estate post listings containing specified pool type by this value. Multiple values can be applied separated by comma",required:!1,schema:{type:"array",items:{type:"string",enum:["none","own","community"]}},example:"own,community"},{name:"barbequeArea",in:"query",description:"Filter to find real estate post listings containing specified barbeque area type by this value. Multiple values can be applied separated by comma",required:!1,schema:{type:"array",items:{type:"string",enum:["none","own","community"]}},example:"own,community"},{name:"parkingSpace",in:"query",description:"Filter to find real estate post listings containing specified parking space type by this value. Multiple values can be applied separated by comma",required:!1,schema:{type:"array",items:{type:"string",enum:["none","driveway","garage"]}},example:"none"},{name:"minCreatedAt",in:"query",description:"Filter to find real estate post listings created after said date value",required:!1,schema:{type:"string",format:"date-time"},example:"2024-02-14T00:00:03.000Z"},{name:"maxCreatedAt",in:"query",description:"Filter to find real estate post listings created before said date value",required:!1,schema:{type:"string",format:"date-time"},example:"2024-05-03T00:00:03.000Z"},{name:"minUpdatedAt",in:"query",description:"Filter to find real estate post listings updated after said date value",required:!1,schema:{type:"string",format:"date-time"},example:"2024-02-14T00:00:03.000Z"},{name:"maxUpdatedAt",in:"query",description:"Filter to find real estate post listings updated before said date value",required:!1,schema:{type:"string",format:"date-time"},example:"2024-05-03T00:00:03.000Z"},{name:"status",in:"query",description:"Filter to find real estate post listings in specified current status. Multiple values can be applied separated by comma",required:!1,schema:{type:"array",items:{type:"string",enum:["ON_SALE","ON_HOLD","SOLD"]}},example:"ON_SALE"},{name:"currency",in:"query",description:"Filter to find real estate post listings valued in specified currency. Multiple values can be applied separated by comma. Mostly used alongside minPrice and maxPrice filters",required:!1,schema:{type:"array",items:{type:"string",enum:["USD","EUR","ARS"]}},example:"USD"},{name:"minPrice",in:"query",description:"Filter to find real estate post listings valued in specified price or higher",required:!1,schema:{type:"number",format:"float",minimum:0,maximum:999999999999e-2},example:75e3},{name:"maxPrice",in:"query",description:"Filter to find real estate post listings valued in specified price or lower",required:!1,schema:{type:"number",format:"float",minimum:0,maximum:999999999999e-2},example:125e3},{name:"limit",in:"query",description:"Limit real estate post listings results on specified maximum value. Default value = 10",required:!1,schema:{type:"integer",format:"int32",minimum:1,maximum:100},example:10},{name:"offset",in:"query",description:"Pagination index for real estate post listings results. Mostly used alongside limit query parameter. Default value = 0",required:!1,schema:{type:"integer",format:"int32",minimum:0},example:0},{name:"order_by",in:"query",description:"Order real estate post listing results based on specified field. Default value = createdAt",required:!1,schema:{type:"string",enum:["title","address","squareMeters","bedrooms","bathrooms","lifeQualityIndex","hasPorch","price","createdAt","updatedAt"]},example:"createdAt"},{name:"order_direction",in:"query",description:"Order real estate post listing results on specified direction. Default value = desc",required:!1,schema:{type:"string",enum:["asc","desc"]},example:"desc"}],responses:{"200":{summary:"real estate post listing results",description:"real estate post listing results based on specified filters",content:{"application/json":{schema:{$ref:"#/components/schemas/GenericResponse"},examples:{"Example successful response with limit 3":{value:{results:[{id:2,title:"House in General Las Heras",address:"Neumi Buzzi 46, General Las Heras, Buenos Aires, Argentina",squareMeters:240,bedrooms:2,bathrooms:1,lifeQualityIndex:6.55,hasPorch:!0,poolType:"none",barbequeArea:"none",parkingSpace:"driveway",status:"SOLD",price:47e3,currency:"USD",created_at:"2024-02-15T16:29:03.000Z",updated_at:null},{id:1,title:"Recreational house in Plomer, Buenos Aires (village located along route 6)",address:"Los Alamos 300, Plomer, General Las Heras, Buenos Aires, Argentina",squareMeters:1600,bedrooms:3,bathrooms:1,lifeQualityIndex:6.28,hasPorch:!0,poolType:"own",barbequeArea:"none",parkingSpace:"driveway",status:"ON_SALE",price:1e5,currency:"USD",created_at:"2024-02-08T17:09:02.000Z",updated_at:null},{id:3,title:"2 dorm house on sale with pool + guest house in Villars",address:"Espa\xF1a 400, Villars, General Las Heras, Buenos Aires, Argentina",squareMeters:280,bedrooms:4,bathrooms:3,lifeQualityIndex:6.3,hasPorch:!0,poolType:"own",barbequeArea:"own",parkingSpace:"driveway",status:"ON_HOLD",price:95e3,currency:"USD",created_at:"2024-01-05T22:27:20.000Z",updated_at:null}],total:39}},"Example successful no-results response":{value:{results:[],total:0}}}}}},"400":{summary:"Invalid input query params",description:"Invalid input query params response",content:{"application/json":{schema:{$ref:"#/components/schemas/GenericResponse"},example:{value:{message:"Invalid request"}}}}},"401":{summary:"Unauthorized response",description:"Unauthorized response",content:{"application/json":{schema:{$ref:"#/components/schemas/GenericResponse"},example:{value:{message:"Unauthorized"}}}}},default:{summary:"Unexpected error",description:"Unexpected error",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"},example:{value:{message:"Internal server error"}}}}}}},post:{summary:"Inserts a new real estate post listing in the database",description:"Inserts an active real estate posting with their details on the database",operationId:"createNewPost",security:[{BearerAuth:[]}],requestBody:{description:"Real estate object to add to the database",required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/RealEstatePost"},examples:{House1:{summary:"An example of a real estate post of a house on sale",description:"An example of a real estate post of a house on sale",value:{title:"House with pool and barbeque area - Las Heras, Buenos Aires countryside",address:"Dorrego 1023, General Las Heras, Buenos Aires, Argentina",squareMeters:100,bedrooms:3,bathrooms:1,lifeQualityIndex:6.33,hasPorch:!0,poolType:"own",barbequeArea:"own",parkingSpace:"driveway",status:"ON_SALE",currency:"USD",price:85e3}}}}}},responses:{"201":{summary:"real estate post object created successfully",description:"real estate post object as it was created",content:{"application/json":{schema:{$ref:"#/components/schemas/SinglePostResponse"},examples:{House1:{id:4,title:"House with pool and barbeque area - Las Heras, Buenos Aires countryside",address:"Dorrego 1023, General Las Heras, Buenos Aires, Argentina",squareMeters:100,bedrooms:3,bathrooms:1,lifeQualityIndex:6.33,hasPorch:!0,poolType:"own",barbequeArea:"own",parkingSpace:"driveway",status:"ON_SALE",price:85e3,currency:"USD",updated_at:"2024-07-14T23:06:53.862Z",created_at:"2024-07-14T23:06:53.862Z",isActive:!0}}}}},"400":{summary:"Invalid body params",description:"Invalid body params",content:{"application/json":{schema:{$ref:"#/components/schemas/GenericResponse"},example:{value:{message:"Invalid request"}}}}},"422":{summary:"could not create real estate post listing",description:"could not create real estate post listing",content:{"application/json":{schema:{$ref:"#/components/schemas/GenericResponse"},example:{value:{message:"Could not create post"}}}}},default:{summary:"Unexpected error",description:"Unexpected error",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"},example:{value:{message:"Internal server error"}}}}}}}},"v1/real-estate-listing/{id}":{get:{summary:"Gets a single real estate post by its ID",description:"Gets a single real estate post by its ID",operationId:"getPost",security:[{BearerAuth:[]}],parameters:{in:"path",name:"id",description:"ID of the real estate post",required:!0,schema:{type:"integer",format:"int32"},example:2},responses:{"200":{summary:"real estate post object",description:"real estate post object",content:{"application/json":{schema:{$ref:"#/components/schemas/SinglePostResponse"},examples:{House1:{id:4,title:"House with pool and barbeque area - Las Heras, Buenos Aires countryside",address:"Dorrego 1023, General Las Heras, Buenos Aires, Argentina",squareMeters:100,bedrooms:3,bathrooms:1,lifeQualityIndex:6.33,hasPorch:!0,poolType:"own",barbequeArea:"own",parkingSpace:"driveway",status:"ON_SALE",price:85e3,currency:"USD",updated_at:"2024-07-14T23:06:53.862Z",created_at:"2024-07-14T23:06:53.862Z",isActive:!0}}}}},"204":{summary:"real estate post listing not found, or marked as inactive",description:"real estate post listing not found, or marked as inactive"},"400":{summary:"Invalid param",description:"Invalid param",content:{"application/json":{schema:{$ref:"#/components/schemas/GenericResponse"},example:{value:{message:"Invalid request"}}}}},default:{summary:"Unexpected error",description:"Unexpected error",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}}}},patch:{summary:"Updates a single real estate post",description:"Updates a single real estate post",operationId:"updatePost",security:[{BearerAuth:[]}],parameters:{in:"path",name:"id",description:"ID of the real estate post",required:!0,schema:{type:"integer",format:"int32"}},requestBody:{description:"Real estate object to patch into the existing one",required:!0,content:{"application/json":{schema:{$ref:"#/components/schemas/RealEstatePatch"},examples:{House1:{summary:"An example of a real estate post listing to update",description:"An example of a real estate post listing to update. This example is linked to the Post 'House1' example",value:{squareMeters:80,bedrooms:4,lifeQualityIndex:6.95,hasPorch:!1,parkingSpace:"garage",price:8e4}}}}}},responses:{"200":{summary:"real estate post listing updated successfully",description:"complete real estate post listing as it was updated",content:{"application/json":{schema:{$ref:"#/components/schemas/GenericResponse"},example:{value:{message:"Post updated successfully"}}}}},"400":{summary:"Invalid path or body param",description:"Invalid path or body param",content:{"application/json":{schema:{$ref:"#/components/schemas/GenericResponse"},example:{value:{message:"Invalid request"}}}}},"422":{summary:"could not update real estate post",description:"could not update real estate post",content:{"application/json":{schema:{$ref:"#/components/schemas/GenericResponse"},example:{value:{message:"Could not update post"}}}}},default:{summary:"Unexpected error",description:"Unexpected error",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}}}},delete:{summary:"soft deletes a single real estate post",description:"soft deletes a single real estate post, by marking it as inactive",operationId:"softDeletePost",security:[{BearerAuth:[]}],parameters:{in:"path",name:"id",description:"ID of the real estate post",required:!0,schema:{type:"integer",format:"int32"}},responses:{"200":{summary:"real estate post listing soft deleted successfully",description:"real estate post listing was soft deleted successfully (marked as inactive)",content:{"application/json":{schema:{$ref:"#/components/schemas/GenericResponse"},example:{value:{message:"Post deleted successfully"}}}}},"400":{summary:"Invalid path param",description:"Invalid path param",content:{"application/json":{schema:{$ref:"#/components/schemas/GenericResponse"},example:{value:{message:"Invalid request"}}}}},"422":{summary:"could not soft delete real estate post",description:"could not soft delete real estate post",content:{"application/json":{schema:{$ref:"#/components/schemas/GenericResponse"},example:{value:{message:"Could not delete post"}}}}},default:{summary:"Unexpected error",description:"Unexpected error",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}}}}}},components:{securitySchemes:{BearerAuth:{name:"Authorization",in:"header",type:"apiKey",scheme:"bearer",bearerFormat:"JWT",description:"Enter your bearer token in the format Bearer <token>"}},schemas:{Login:{type:"object",required:["clientId","clientSecret"],properties:{clientId:{type:"string",minLength:1,maxLength:255,format:"password"},clientSecret:{type:"string",minLength:1,maxLength:255,format:"password"}}},LoginResponseSuccess:{type:"object",required:["accessToken","scopes","expiresIn"],properties:{accessToken:{type:"string",format:"password"},scopes:{type:"array",items:{type:"string",enum:["read.real-estate-post","write.real-estate-post"]}},expiresIn:{type:"integer",format:"int32",minimum:1}}},RealEstatePost:{type:"object",required:["title","address","squareMeters","bedrooms","bathrooms","hasPorch","poolType","barbequeArea","parkingSpace","status","currency","price"],properties:{title:{type:"string",description:"Real estate post title"},address:{type:"string",description:"Property address"},squareMeters:{type:"integer",format:"int32",description:"Property total square meters (including covered area and outdoors area)"},bedrooms:{type:"integer",format:"int32",description:"Quantity of bedrooms that the property has"},bathrooms:{type:"integer",format:"int32",description:"Quantity of bathrooms that the property has"},lifeQualityIndex:{type:"number",format:"float",description:"Life quality index (source: https://icv.conicet.gov.ar/ ) of the area where the property is located"},hasPorch:{type:"boolean",description:"Condition indicating if the property has a porch"},poolType:{type:"string",description:"Pool ownership type of the property",enum:["none","own","community"]},barbequeArea:{type:"string",description:"Barbeque area ownership type of the property",enum:["none","own","community"]},parkingSpace:{type:"string",description:"Type of parking space of the property",enum:["none","driveway","garage"]},status:{type:"string",description:"Status of the real estate post listing",enum:["ON_SALE","ON_HOLD","SOLD"]},currency:{type:"string",description:"Currency in which the price of the real estate post listing is expressed",enum:["USD","EUR","ARS"]},price:{type:"number",format:"int32",description:"Price of the real estate post listing"}}},RealEstatePatch:{type:"object",properties:{title:{type:"string",description:"Real estate post title"},address:{type:"string",description:"Property address"},squareMeters:{type:"integer",format:"int32",description:"Property total square meters (including covered area and outdoors area)"},bedrooms:{type:"integer",format:"int32",description:"Quantity of bedrooms that the property has"},bathrooms:{type:"integer",format:"int32",description:"Quantity of bathrooms that the property has"},lifeQualityIndex:{type:"number",format:"float",description:"Life quality index (source: https://icv.conicet.gov.ar/ ) of the area where the property is located"},hasPorch:{type:"boolean",description:"Condition indicating if the property has a porch"},poolType:{type:"string",description:"Pool ownership type of the property",enum:["none","own","community"]},barbequeArea:{type:"string",description:"Barbeque area ownership type of the property",enum:["none","own","community"]},parkingSpace:{type:"string",description:"Type of parking space of the property",enum:["none","driveway","garage"]},status:{type:"string",description:"Status of the real estate post listing",enum:["ON_SALE","ON_HOLD","SOLD"]},currency:{type:"string",description:"Currency in which the price of the real estate post listing is expressed",enum:["USD","EUR","ARS"]},price:{type:"number",format:"int32",description:"Price of the real estate post listing"}}},SinglePostResponse:{type:"object",required:["id","title","address","squareMeters","bedrooms","bathrooms","lifeQualityIndex","hasPorch","poolType","barbequeArea","parkingSpace","status","price","currency","updated_at","created_at","isActive"],properties:{id:{type:"integer",format:"int32",description:"ID of real estate post listing"},title:{type:"string",description:"Real estate post title"},address:{type:"string",description:"Property address"},squareMeters:{type:"integer",format:"int32",description:"Property total square meters (including covered area and outdoors area)"},bedrooms:{type:"integer",format:"int32",description:"Quantity of bedrooms that the property has"},bathrooms:{type:"integer",format:"int32",description:"Quantity of bathrooms that the property has"},lifeQualityIndex:{type:"number",format:"float",description:"Life quality index (source: https://icv.conicet.gov.ar/ ) of the area where the property is located"},hasPorch:{type:"boolean",description:"Condition indicating if the property has a porch"},poolType:{type:"string",description:"Pool ownership type of the property",enum:["none","own","community"]},barbequeArea:{type:"string",description:"Barbeque area ownership type of the property",enum:["none","own","community"]},parkingSpace:{type:"string",description:"Type of parking space of the property",enum:["none","driveway","garage"]},status:{type:"string",description:"Status of the real estate post listing",enum:["ON_SALE","ON_HOLD","SOLD"]},currency:{type:"string",description:"Currency in which the price of the real estate post listing is expressed",enum:["USD","EUR","ARS"]},price:{type:"number",format:"int32",description:"Price of the real estate post listing"},created_at:{type:"string",format:"date-time",description:"ISO datetime of the creation of the real estate post listing"},updated_at:{type:"string",format:"date-time",description:"ISO datetime of the last update datetime of the real estate post listing"},isActive:{type:"boolean",description:"Condition indicating if the real estate post listing is an active record (not being soft-deleted)"}}},GenericResponse:{type:"object",required:["message"],properties:{message:{type:"string"}}},Error:{type:"object",required:["message"],properties:{message:{type:"string"}}}}}};var g=(0,B.default)(),M=Ee.default.get("port")||3e3;g.use(B.default.json());g.use((0,xe.default)());g.use("/api-docs",F.default.serve);g.get("/api-docs",F.default.setup(Ae));g.use("/v1/auth",pe);g.use("/v1/real-estate-listing",be,fe);g.use(he);console.info(`Starting database connections and API server on port ${M}...`);g.listen(M,async()=>{try{await p.authenticate(),console.info("Connected to database"),await b.connect(),b.isOpen?console.info("Connected to redis instance"):(console.error("Could not connect to redis instance"),process.exit(1)),console.info(`Server running on port ${M}`)}catch(e){console.error(e),console.error(`Database connection error: ${e}`),process.exit(1)}});
